function checkLoginState(){FB.getLoginStatus(function(e){statusChangeCallback(e)})}function statusChangeCallback(e){"connected"===e.status?(loading(),loadProfile(),getReactions(function(e){getPicUrl(e,function(e){$("#result").DataTable({processing:!0,searching:!0,retrieve:!0,paging:!0,data:e,columns:[{title:"Name",data:"name"},{title:"Picture",data:"picture"},{title:'<img src="img/like.gif" width="40px" style="min-width:40px"/><span>Like</span>',data:"type.like"},{title:'<img src="img/love.gif" width="40px" style="min-width:40px"/><span>Love</span>',data:"type.love"},{title:'<img src="img/haha.gif" width="40px" style="min-width:40px"/><span>Haha</span>',data:"type.haha"},{title:'<img src="img/wow.gif" width="40px" style="min-width:40px"/><span>Wow</span>',data:"type.wow"},{title:'<img src="img/sad.gif" width="40px" style="min-width:40px"/><span>Sad</span>',data:"type.sad"},{title:'<img src="img/angry.gif" width="40px" style="min-width:40px"/><span>Angry</span>',data:"type.angry"}]}),loadDataSuccess()})})):noLogin()}function loadProfile(){FB.api("/me/picture?type=large",function(e){document.getElementById("profilePicture").src=e.data.url,document.getElementById("profileData").style.display="block"}),FB.api("/me?fields=name,id",function(e){document.getElementById("profileName").innerHTML="สวัสดีคุณ "+e.name+" ^^",document.getElementById("profileLink").href="https://web.facebook.com/"+e.id})}function getReactions(e){var t=[];FB.api("/me/feed?fields=reactions{type,name}&limit=100",function(a){a.data.forEach(function(e){e.reactions&&e.reactions.data.forEach(function(e){var a=t.filter(function(t){return t.id===e.id})[0];if(a)countReactionType(a,e.type);else{var n={id:e.id,name:e.name,picture:"#",type:{like:0,love:0,haha:0,wow:0,sad:0,angry:0}};countReactionType(n,e.type),t.push(n)}})}),e(t)})}function getPicUrl(e,t){var a=[],n=0;e.forEach(function(e){n++,FB.api("/"+e.id+"/picture?type=large",function(i){e.picture='<img alt="'+e.name+'" class="img-thumbnail img-responsive zoom" src="'+(i.data.url||"#")+'" width="40%" style="min-width:82px"/>',a.push(e),n===a.length&&t(a)})})}function countReactionType(e,t){switch(t){case"LIKE":e.type.like+=1;break;case"LOVE":e.type.love+=1;break;case"HAHA":e.type.hana+=1;break;case"WOW":e.type.wow+=1;break;case"SAD":e.type.sad+=1;break;case"ANGRY":e.type.angry+=1;break;default:e.type.like+=1}}function loadDataSuccess(){document.getElementById("retrievingData").style.display="none",document.getElementById("displayData").style.display="block"}function noLogin(){document.getElementById("retrievingData").style.display="none",document.getElementById("displayData").style.display="none",document.getElementById("profileData").style.display="none"}function loading(){document.getElementById("retrievingData").style.display="block",document.getElementById("displayData").style.display="none"}window.fbAsyncInit=function(){FB.init({appId:"1953883458227413",cookie:!0,xfbml:!0,version:"v2.10"}),FB.AppEvents.logPageView();var e=function(){checkLoginState()};FB.Event.subscribe("xfbml.render",e)},function(e,t,a){var n,i=e.getElementsByTagName(t)[0];e.getElementById(a)||((n=e.createElement(t)).id=a,n.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(n,i))}(document,"script","facebook-jssdk");